<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Soul Confidant</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
body {
  background:#0f172a;
  color:#e5e7eb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}
.chat {
  max-width:600px;
  margin:auto;
  height:100vh;
  display:flex;
  flex-direction:column;
}
.messages {
  flex:1;
  overflow-y:auto;
  padding:16px;
}
.msg {
  margin-bottom:12px;
  max-width:80%;
  padding:10px 14px;
  border-radius:14px;
}
.user {
  background:#2563eb;
  margin-left:auto;
}
.ai {
  background:#334155;
}
.input {
  display:flex;
  gap:8px;
  padding:12px;
  border-top:1px solid #334155;
}
textarea {
  flex:1;
  background:#1e293b;
  border:none;
  border-radius:10px;
  padding:10px;
  color:white;
  resize:none;
}
button {
  background:#ec4899;
  padding:0 16px;
  border-radius:10px;
}
.mode {
  display:flex;
  gap:8px;
  padding:8px;
}
.mode button {
  flex:1;
  background:#1e293b;
}
.mode .active {
  background:#ec4899;
}
</style>
</head>

<body>

<div class="chat">
  <div class="p-4 border-b border-slate-700">
    <h1 class="font-bold text-lg">Soul Confidant</h1>
    <p class="text-sm text-pink-400">A safe place to talk</p>
  </div>

  <div id="messages" class="messages"></div>

  <div class="mode">
    <button id="ventBtn" class="active" onclick="setMode('advice')">❤️ Vent</button>
    <button id="gossipBtn" onclick="setMode('gossip')">⚡ Gossip</button>
  </div>

  <div class="input">
    <textarea id="input" rows="2" placeholder="Type here..."></textarea>
    <button onclick="send()">➤</button>
  </div>
</div>

<script>
const BACKEND_URL = "https://dert-sirdasi-api.captsertacgul.workers.dev";
let MODE = "advice";

function add(text, who) {
  const div = document.createElement("div");
  div.className = "msg " + who;
  div.textContent = text;
  document.getElementById("messages").appendChild(div);
  document.getElementById("messages").scrollTop = 99999;
}

function setMode(m) {
  MODE = m;
  ventBtn.classList.toggle("active", m==="advice");
  gossipBtn.classList.toggle("active", m==="gossip");
}

async function send() {
  const input = document.getElementById("input");
  const text = input.value.trim();
  if (!text) return;
  input.value = "";

  add(text,"user");

  try {
    const res = await fetch(BACKEND_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ message:text, mode:MODE })
    });

    const data = await res.json();

    if (!res.ok) {
      add(data.reply || "Server error","ai");
      return;
    }

    add(data.reply,"ai");

  } catch(e) {
    add("I couldn't reach the server. Please try again.","ai");
  }
}

add("Hello. I'm here for you. Tell me what's on your mind.","ai");
</script>

</body>
</html>
