<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dert Sırdaşı</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#111827">

  <link rel="apple-touch-icon" href="./icon-180.png">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white">

<div class="max-w-md mx-auto h-screen flex flex-col">

  <header class="p-4 border-b border-gray-700">
    <h1 class="text-xl font-bold">Dert Sırdaşı</h1>
    <p class="text-sm text-gray-400">Seninle konuşmak iyi gelecek</p>
  </header>

  <div id="chatBox" class="flex-1 overflow-y-auto p-4 space-y-3"></div>

  <div class="p-4 border-t border-gray-700 flex gap-2">
    <textarea id="input" class="flex-1 bg-gray-800 rounded p-2 text-sm" rows="2" placeholder="Yaz..."></textarea>
    <button onclick="send()" class="bg-pink-600 px-4 rounded">Gönder</button>
  </div>

</div>

<script>
/* ===============================
   BACKEND ENDPOINT (TEK YER)
   =============================== */
const ENDPOINT = "https://dert-sirdasi-api.captsertacgul.workers.dev";

/* ===============================
   CHAT UI
   =============================== */
function addMessage(text, who) {
  const div = document.createElement("div");
  div.className = who === "user"
    ? "text-right bg-pink-600 p-2 rounded"
    : "text-left bg-gray-700 p-2 rounded";
  div.innerText = text;
  document.getElementById("chatBox").appendChild(div);
  document.getElementById("chatBox").scrollTop = 999999;
}

/* ===============================
   SEND MESSAGE
   =============================== */
async function send() {
  const input = document.getElementById("input");
  const text = input.value.trim();
  if (!text) return;

  input.value = "";
  addMessage(text, "user");

  try {
    const res = await fetch(ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: text,
        mode: "advice",
        language: "tr"
      })
    });

    const data = await res.json();
    addMessage(data.reply || "Cevap alınamadı", "ai");

  } catch (e) {
    addMessage("Bağlantı hatası", "ai");
  }
}
</script>

</body>
</html>
