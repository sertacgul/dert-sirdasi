<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Dert Sırdaşı</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#111827">

<link rel="apple-touch-icon" href="icon-180.png">
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#111827; color:#e5e7eb; font-family: system-ui; margin:0 }
.chat { height:100vh; display:flex; flex-direction:column; max-width:600px; margin:auto }
.messages { flex:1; overflow-y:auto; padding:16px }
.msg { margin-bottom:12px; max-width:85%; padding:12px; border-radius:16px }
.user { background:#ec4899; color:white; margin-left:auto }
.ai { background:#334155 }
.input { display:flex; gap:8px; padding:12px; border-top:1px solid #374151 }
textarea { flex:1; border-radius:12px; padding:10px; background:#1f2937; color:white }
button { background:#ec4899; color:white; border-radius:12px; padding:0 16px }
</style>
</head>

<body>
<div class="chat">
  <div id="messages" class="messages"></div>
  <div class="input">
    <textarea id="input" rows="2" placeholder="Yaz bakalım..."></textarea>
    <button onclick="send()">➤</button>
  </div>
</div>

<script>
const ENDPOINT = "https://dert-sirdasi-api.captsertacgul.workers.dev/chat";

const messagesEl = document.getElementById("messages");
const inputEl = document.getElementById("input");

const memoryKey = "ds_last_conversation";
const todayKey = new Date().toISOString().slice(0,10);

function addMsg(text, who) {
  const div = document.createElement("div");
  div.className = "msg " + who;
  div.innerText = text;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function checkYesterday() {
  const last = localStorage.getItem(memoryKey);
  if (!last) return;

  const lastDate = new Date(last).toISOString().slice(0,10);
  const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0,10);

  if (lastDate === yesterday) {
    addMsg(
      "Dün konuştuğumuz konu ne durumda? Hâlâ devam ediyor mu, biraz anlatmak ister misin?",
      "ai"
    );
  }
}

async function send() {
  const text = inputEl.value.trim();
  if (!text) return;

  addMsg(text, "user");
  inputEl.value = "";

  localStorage.setItem(memoryKey, new Date().toISOString());

  const res = await fetch(ENDPOINT, {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ message: text })
  });

  const data = await res.json();
  addMsg(data.reply || "Şu an cevap veremedim.", "ai");
}

checkYesterday();
</script>
</body>
</html>
