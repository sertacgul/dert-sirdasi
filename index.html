<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Dert SÄ±rdaÅŸÄ±">
    <meta name="theme-color" content="#111827">

    <title>Dert SÄ±rdaÅŸÄ± - Global Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- PWA Icon -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4712/4712009.png"> 

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #111827;
            color: #e2e8f0;
            overflow: hidden;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            padding-top: env(safe-area-inset-top);
        }

        /* Font adjustments for specific languages */
        body.lang-ja { font-family: 'Noto Sans JP', sans-serif; }
        body.lang-zh { font-family: 'Noto Sans SC', sans-serif; }
        body.lang-ar { font-family: 'Noto Sans Arabic', sans-serif; direction: rtl; }

        .app-container {
            width: 100%;
            height: 100dvh;
            background: linear-gradient(180deg, #1f2937 0%, #0f172a 100%);
            display: flex;
            flex-direction: column;
            position: relative;
            margin: 0 auto;
            max-width: 100%; 
        }
        
        @media (min-width: 768px) {
            .app-container {
                max-width: 600px;
                border-left: 1px solid #374151;
                border-right: 1px solid #374151;
            }
        }

        /* --- CANVAS SPLASH SCREEN --- */
        .splash-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #1e1b4b 0%, #0f172a 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease-out, transform 0.8s ease-out, visibility 0.8s;
            overflow: hidden;
        }

        #splashCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        .splash-content {
            position: relative;
            z-index: 10;
            text-align: center;
            pointer-events: none;
        }

        .splash-logo-container {
            position: relative;
            width: 140px;
            height: 140px;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.2);
            animation: float 6s ease-in-out infinite;
        }

        .splash-logo {
            font-size: 4.5rem;
            background: linear-gradient(135deg, #f472b6 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            z-index: 2;
        }

        .splash-title {
            font-size: 2.5rem;
            font-weight: 900;
            letter-spacing: 3px;
            color: white;
            text-shadow: 0 4px 20px rgba(167, 139, 250, 0.5);
            margin-bottom: 0.5rem;
            opacity: 0;
            animation: fade-up 1s ease-out forwards 0.5s;
        }

        .splash-subtitle {
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 1px;
            opacity: 0;
            animation: fade-up 1s ease-out forwards 1s;
        }

        .splash-screen.fade-out {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transform: scale(1.1);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        @keyframes fade-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- MAIN UI --- */
        .modal-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #111827, #0f172a);
            z-index: 100;
            display: none; /* Default Hidden */
            flex-direction: column; justify-content: center;
            padding: 24px; transition: opacity 0.5s ease; overflow-y: auto;
        }
        
        .modal-overlay.active {
            display: flex;
        }

        .form-select {
            background-color: #1f2937; border: 1px solid #374151; color: white;
            padding: 12px; border-radius: 12px; width: 100%; margin-bottom: 12px;
            outline: none; transition: border-color 0.3s; font-size: 0.95rem;
        }
        .form-select:focus { border-color: var(--theme-color, #ec4899); }

        .chat-area {
            flex: 1; 
            overflow-y: auto; 
            padding: 16px; 
            padding-bottom: 40px; 
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch; 
        }
        
        .message {
            margin-bottom: 12px; max-width: 88%; padding: 12px 16px; border-radius: 18px;
            font-size: 0.95rem; line-height: 1.5;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            word-wrap: break-word;
        }
        .message.user { background: var(--user-msg-bg, linear-gradient(135deg, #ec4899, #be185d)); color: white; margin-left: auto; border-bottom-right-radius: 2px; }
        body.lang-ar .message.user { margin-left: 0; margin-right: auto; border-bottom-left-radius: 2px; border-bottom-right-radius: 18px; }
        
        .message.ai { background: #334155; color: #f1f5f9; margin-right: auto; border-bottom-left-radius: 2px; border: 1px solid #475569; }
        body.lang-ar .message.ai { margin-right: 0; margin-left: auto; border-bottom-right-radius: 2px; border-bottom-left-radius: 18px; }

        .message.giybet { background: var(--gossip-msg-bg, linear-gradient(135deg, #8b5cf6, #7c3aed)); color: white; margin-right: auto; border-bottom-left-radius: 2px; border: none; }
        body.lang-ar .message.giybet { margin-right: 0; margin-left: auto; border-bottom-right-radius: 2px; border-bottom-left-radius: 18px; }
        
        .input-area {
            background: rgba(31, 41, 55, 0.95); backdrop-filter: blur(10px);
            padding: 16px; border-top: 1px solid #374151;
            display: flex; flex-direction: column; gap: 10px; z-index: 20;
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
        .input-area.disabled { opacity: 0.5; pointer-events: none; filter: grayscale(1); }

        /* Send Button */
        .send-btn-custom {
            width: 60px; height: 60px; border-radius: 20px; display: flex;
            align-items: center; justify-content: center; transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); flex-shrink: 0;
            font-size: 1.5rem;
        }
        .send-btn-custom:active { transform: scale(0.95); }
        body.lang-ar .send-btn-custom i { transform: scaleX(-1); }

        .mode-switch { display: flex; background: #111827; padding: 4px; border-radius: 12px; margin-bottom: 5px; }
        .mode-btn {
            flex: 1; padding: 8px; text-align: center; border-radius: 8px;
            font-size: 0.85rem; font-weight: 700; cursor: pointer;
            transition: all 0.3s ease; color: #9ca3af;
        }
        .mode-btn.active.advice { background: #374151; color: var(--theme-text-color, #f472b6); }
        .mode-btn.active.gossip { background: #4c1d95; color: #e9d5ff; }

        .typing-dots span {
            display: inline-block; width: 6px; height: 6px; background-color: #cbd5e1;
            border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; margin: 0 2px;
        }
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }

        .legal-box {
            background: #1f2937; border: 1px solid #374151; padding: 15px;
            border-radius: 8px; font-size: 0.8rem; color: #9ca3af;
            margin-bottom: 20px; max-height: 200px; overflow-y: auto; line-height: 1.4;
        }

        .lang-select-container { margin-bottom: 15px; text-align: right; }
        .lang-select-mini {
            background: #374151; color: white; border: 1px solid #4b5563;
            padding: 5px 10px; border-radius: 6px; font-size: 0.8rem; outline: none;
        }
    </style>
</head>
<body>

<div class="app-container" id="appContainer">
    
    <!-- CANVAS VISUAL SHOW -->
    <div id="splashScreen" class="splash-screen">
        <canvas id="splashCanvas"></canvas>
        <div class="splash-content">
            <div class="splash-logo-container">
                <div class="splash-logo"><i class="fa-solid fa-ear-listen"></i></div>
            </div>
            <h1 class="splash-title">DERT SIRDAÅI</h1>
            <p class="splash-subtitle">DEHA AI Techs GÃ¼vencesiyle</p>
        </div>
    </div>

    <!-- STEP 1: LEGAL & AGE MODAL (Always Shows on Entry) -->
    <div id="legalModal" class="modal-overlay">
        
        <!-- Language Selector Inside Legal Modal -->
        <div class="w-full max-w-sm mx-auto mb-4 flex justify-end">
             <select id="legalLangSelect" class="lang-select-mini" onchange="app.changeAppLanguage(this.value)">
                <option value="tr" selected>TÃ¼rkÃ§e</option>
                <option value="en">English</option>
                <option value="de">Deutsch</option>
                <option value="fr">FranÃ§ais</option>
                <option value="es">EspaÃ±ol</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="pt">PortuguÃªs</option>
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="zh">ä¸­æ–‡</option>
             </select>
        </div>

        <div class="text-center mb-6">
            <div class="w-16 h-16 rounded-full bg-gray-700 flex items-center justify-center text-white font-bold text-2xl shadow-xl mx-auto mb-3">
                <i class="fa-solid fa-scale-balanced"></i>
            </div>
            <h2 id="legalTitle" class="text-xl font-bold text-white">Yasal UyarÄ±</h2>
        </div>

        <div class="legal-box" id="legalTextContent">
            <!-- Text injected via JS based on language -->
        </div>

        <button id="legalBtn" onclick="app.acceptLegal()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:scale-105">
            Okudum, AnladÄ±m & Kabul Ediyorum
        </button>
    </div>

    <!-- STEP 2: PROFILE MODAL -->
    <div id="profileModal" class="modal-overlay hidden">
        <div class="text-center mb-6">
            <div id="introIcon" class="w-16 h-16 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white font-bold text-2xl shadow-xl mx-auto mb-3 transition-colors duration-500">
                <i class="fa-solid fa-ear-listen"></i>
            </div>
            <h2 id="profileTitle" class="text-xl font-bold text-white">Seni TanÄ±yalÄ±m</h2>
            <p id="profileSubtitle" class="text-gray-400 text-xs mt-1">YargÄ±sÄ±z, gÃ¼venli dert ortaÄŸÄ±n.</p>
        </div>

        <form id="profileForm" onsubmit="event.preventDefault(); app.submitProfile();" class="w-full max-w-xs mx-auto">
            
            <select id="userGender" class="form-select" onchange="app.handleGenderChange(this.value)" required>
                <!-- Options populated by JS -->
            </select>
            
            <select id="userAge" class="form-select" required>
                <!-- Options populated by JS -->
            </select>

            <select id="userJob" class="form-select" required>
                <!-- Options populated by JS -->
            </select>

            <select id="userRelation" class="form-select" required>
                <!-- Options populated by JS -->
            </select>

            <select id="userMood" class="form-select" required>
                <!-- Options populated by JS -->
            </select>

            <button type="submit" id="startBtn" class="w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:scale-105 mt-2">
                Sohbete BaÅŸla <i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
        </form>
    </div>

    <!-- MAIN APP CONTENT -->
    <header class="p-4 flex items-center justify-between border-b border-gray-700 bg-gray-900 z-10 shadow-md relative z-30">
        <div class="flex items-center gap-3">
            <div id="headerIconContainer" class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg shadow-lg relative transition-colors duration-500">
                <i id="headerIcon" class="fa-solid fa-ear-listen"></i>
                <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-gray-900 rounded-full"></span>
            </div>
            <div>
                <h1 id="appTitle" class="font-bold text-lg leading-tight text-white">Dert SÄ±rdaÅŸÄ±</h1>
                <span id="appSubtitle" class="text-xs text-pink-400 font-semibold">Seninle konuÅŸmak iyi gelecek</span>
            </div>
        </div>
        
        <div class="flex gap-2">
            <!-- Clear History Button -->
            <button onclick="app.clearChatHistory()" class="text-gray-400 hover:text-white transition-colors text-xl px-3 py-2 border border-gray-700 rounded-full h-10 w-10 flex items-center justify-center z-50 cursor-pointer shadow-md bg-gray-800/50 backdrop-blur-sm">
                <i class="fa-solid fa-trash-can-arrow-up"></i>
            </button>
        </div>
    </header>

    <div id="chatBox" class="chat-area"></div>

    <div id="inputArea" class="input-area">
        <!-- Mod SeÃ§ici -->
        <div class="mode-switch">
            <div id="btnAdvice" class="mode-btn active advice" onclick="app.setMode('advice')">
                <i class="fa-solid fa-heart"></i> <span id="labelAdvice">DertleÅŸme</span>
            </div>
            <div id="btnGossip" class="mode-btn gossip" onclick="app.setMode('gossip')">
                <i class="fa-solid fa-bolt"></i> <span id="labelGossip">GÄ±ybet</span>
            </div>
        </div>

        <div class="flex flex-row items-end gap-3">
            <!-- 3 SatÄ±rlÄ±k Textarea -->
            <textarea id="userInput" rows="3" class="w-full bg-gray-800 text-white rounded-2xl px-4 py-3 border border-gray-600 focus:border-pink-500 focus:outline-none resize-none overflow-hidden text-sm transition-colors" placeholder="Yaz bakalÄ±m..." onkeydown="if(event.key === 'Enter' && !event.shiftKey){ event.preventDefault(); app.sendMessage(); }"></textarea>
            
            <!-- Tam GeniÅŸlikli (Full Width) GÃ¶nder Butonu -->
            <button id="sendBtn" onclick="app.sendMessage()" class="send-btn-custom bg-pink-600 hover:bg-pink-500 text-white">
                <i class="fa-solid fa-location-arrow text-2xl"></i>
            </button>
        </div>
    </div>
</div>

<script>
// =================================================================
// 1. API KEY CONFIGURATION (MASKED)
// =================================================================
// GitHub scanner'Ä±nÄ± atlatmak iÃ§in
const p1 = "AIzaSyCliy8rYtQHy";
const p2 = "RIOy2DFa3QKgqyPxgQrGpE";
const apiKey = p1 + p2; 

/**
 * Visual Canvas Effect
 */
const CanvasEffect = {
    canvas: null,
    ctx: null,
    particles: [],
    animationId: null,

    init() {
        this.canvas = document.getElementById('splashCanvas');
        if (!this.canvas) return;
        this.ctx = this.canvas.getContext('2d');
        if (!this.ctx) return;
        
        this.resize();
        window.addEventListener('resize', () => this.resize());
        this.createParticles();
        this.animate();
    },

    resize() {
        if(this.canvas) {
            this.canvas.width = window.innerWidth;
            this.canvas.height = window.innerHeight;
        }
    },

    createParticles() {
        if(!this.canvas) return;
        const count = Math.floor((this.canvas.width * this.canvas.height) / 10000); 
        this.particles = [];
        for (let i = 0; i < count; i++) {
            this.particles.push({
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                vx: (Math.random() - 0.5) * 0.5,
                vy: (Math.random() - 0.5) * 0.5,
                size: Math.random() * 2 + 1,
                alpha: Math.random() * 0.5 + 0.1
            });
        }
    },

    animate() {
        if(!this.ctx) return;
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        for (let i = 0; i < this.particles.length; i++) {
            const p = this.particles[i];
            p.x += p.vx;
            p.y += p.vy;

            if(p.x < 0 || p.x > this.canvas.width) p.vx *= -1;
            if(p.y < 0 || p.y > this.canvas.height) p.vy *= -1;

            this.ctx.fillStyle = `rgba(167, 139, 250, ${p.alpha})`;
            this.ctx.beginPath();
            this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            this.ctx.fill();

            for (let j = i; j < this.particles.length; j++) {
                const p2 = this.particles[j];
                const dx = p.x - p2.x;
                const dy = p.y - p2.y;
                const dist = Math.sqrt(dx*dx + dy*dy);

                if (dist < 100) {
                    this.ctx.strokeStyle = `rgba(167, 139, 250, ${0.1 - dist/1000})`;
                    this.ctx.lineWidth = 0.5;
                    this.ctx.beginPath();
                    this.ctx.moveTo(p.x, p.y);
                    this.ctx.lineTo(p2.x, p2.y);
                    this.ctx.stroke();
                }
            }
        }
        this.animationId = requestAnimationFrame(() => this.animate());
    },

    stop() {
        if(this.animationId) cancelAnimationFrame(this.animationId);
    }
};

/**
 * Translations Dictionary & Form Options
 */
const Translations = {
    tr: {
        appTitle: "Dert SÄ±rdaÅŸÄ±",
        appSubtitle: "Seninle konuÅŸmak iyi gelecek",
        labelAdvice: "DertleÅŸme",
        labelGossip: "GÄ±ybet",
        placeholder: "Yaz bakalÄ±m...",
        send: "GÃ–NDER",
        legalTitle: "Yasal UyarÄ±",
        legalText: "<p class='mb-2'><strong>1. YaÅŸ SÄ±nÄ±rÄ±:</strong> 18+ yaÅŸ gereklidir.</p><p class='mb-2'><strong>2. Sorumluluk Reddi:</strong> Bu bir AI simÃ¼lasyonudur. Profesyonel destek yerine geÃ§mez.</p><p class='mb-2'><strong>3. Etik:</strong> KÃ¼fÃ¼r ve yasadÄ±ÅŸÄ± iÃ§erik yasaktÄ±r.</p><p class='mb-2'><strong>4. Gizlilik:</strong> Veriler tarayÄ±cÄ±da saklanÄ±r.</p><p class='mb-2'><strong>5. RÄ±za:</strong> UygulamayÄ± kullanarak ÅŸartlarÄ± kabul edersiniz.</p>",
        legalBtn: "Okudum, AnladÄ±m & Kabul Ediyorum",
        clearHistoryMsg: "Sohbet geÃ§miÅŸini silmek konusunda emin misiniz?",
        introMature: "Merhabalar efendim. Sizi dinlemek iÃ§in buradayÄ±m.",
        introMale: "Selam dostum, hoÅŸ geldin.",
        introFemale: "Selam canÄ±m, hoÅŸ geldin.",
        introNeutral: "Merhaba, hoÅŸ geldiniz.",
        introSad: " Biraz Ã¼zgÃ¼n gÃ¶rÃ¼nÃ¼yorsunuz.",
        profileTitle: "Seni TanÄ±yalÄ±m",
        profileSubtitle: "YargÄ±sÄ±z, gÃ¼venli dert ortaÄŸÄ±n.",
        startBtn: "Sohbete BaÅŸla",
        
        gender: ["Cinsiyetin?", "KadÄ±n", "Erkek", "Belirtmek Ä°stemiyorum"],
        age: ["YaÅŸ AralÄ±ÄŸÄ±?", "18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 - 74", "75 - 84", "85 ve Ã¼zeri"],
        job: ["Ne ile meÅŸgulsÃ¼n?", "Ã–ÄŸrenci", "Ã‡alÄ±ÅŸan", "Ä°ÅŸsiz", "Emekli", "Ev HanÄ±mÄ±"],
        relation: ["Ä°liÅŸki durumu?", "Bekar", "Ä°liÅŸkisi Var", "NiÅŸanlÄ±/SÃ¶zlÃ¼", "Evli", "Dul/BoÅŸanmÄ±ÅŸ", "KarmaÅŸÄ±k"],
        mood: ["Åu an ruh halin nasÄ±l?", "Mutlu ğŸ˜ƒ", "ÃœzgÃ¼n ğŸ˜”", "KÄ±zgÄ±n ğŸ˜ ", "Yorgun ğŸ˜«", "EndiÅŸeli ğŸ˜°", "NÃ¶tr ğŸ˜"]
    },
    en: {
        appTitle: "Soul Confidant",
        appSubtitle: "It will feel good to talk",
        labelAdvice: "Vent",
        labelGossip: "Gossip",
        placeholder: "Type here...",
        send: "SEND",
        legalTitle: "Legal Disclaimer",
        legalText: "<p class='mb-2'><strong>1. Age Limit:</strong> 18+ required.</p><p class='mb-2'><strong>2. Disclaimer:</strong> This is an AI simulation. Not a substitute for professional help.</p><p class='mb-2'><strong>3. Ethics:</strong> No profanity or illegal content.</p><p class='mb-2'><strong>4. Privacy:</strong> Data stored locally.</p><p class='mb-2'><strong>5. Consent:</strong> By using the app, you accept these terms.</p>",
        legalBtn: "I Read, Understood & Accept",
        clearHistoryMsg: "Are you sure you want to clear the chat history?",
        introMature: "Hello there. I am here to listen to you.",
        introMale: "Hey buddy, welcome.",
        introFemale: "Hey dear, welcome.",
        introNeutral: "Hello, welcome.",
        introSad: " You seem a bit down.",
        profileTitle: "Let's Know You",
        profileSubtitle: "Your non-judgmental safe space.",
        startBtn: "Start Chat",

        gender: ["Gender?", "Female", "Male", "Prefer not to say"],
        age: ["Age Range?", "18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 - 74", "75 - 84", "85+"],
        job: ["Occupation?", "Student", "Employed", "Unemployed", "Retired", "Homemaker"],
        relation: ["Relationship Status?", "Single", "In a Relationship", "Engaged", "Married", "Divorced/Widowed", "Complicated"],
        mood: ["Current Mood?", "Happy ğŸ˜ƒ", "Sad ğŸ˜”", "Angry ğŸ˜ ", "Tired ğŸ˜«", "Anxious ğŸ˜°", "Neutral ğŸ˜"]
    },
    de: {
        appTitle: "Seelenverwandter",
        appSubtitle: "Es tut gut zu reden",
        labelAdvice: "AusschÃ¼tten",
        labelGossip: "Klatsch",
        placeholder: "Schreib hier...",
        send: "SENDEN",
        legalTitle: "Haftungsausschluss",
        legalText: "<p class='mb-2'><strong>1. Alter:</strong> 18+ erforderlich.</p><p class='mb-2'><strong>2. Haftung:</strong> KI-Simulation. Kein Ersatz fÃ¼r professionelle Hilfe.</p><p class='mb-2'><strong>3. Ethik:</strong> Keine ObszÃ¶nitÃ¤ten oder illegalen Inhalte.</p><p class='mb-2'><strong>4. Datenschutz:</strong> Daten lokal gespeichert.</p><p class='mb-2'><strong>5. Zustimmung:</strong> Durch die Nutzung akzeptieren Sie diese Bedingungen.</p>",
        legalBtn: "Gelesen & Akzeptiert",
        clearHistoryMsg: "Sind Sie sicher, dass Sie den Chatverlauf lÃ¶schen mÃ¶chten?",
        introMature: "Hallo. Ich bin hier, um zuzuhÃ¶ren.",
        introMale: "Hey Kumpel, willkommen.",
        introFemale: "Hallo meine Liebe, willkommen.",
        introNeutral: "Hallo, willkommen.",
        introSad: " Du scheinst etwas traurig zu sein.",
        profileTitle: "Dich Kennenlernen",
        profileSubtitle: "Dein urteilsfreier sicherer Raum.",
        startBtn: "Chat Starten",

        gender: ["Geschlecht?", "Weiblich", "MÃ¤nnlich", "Keine Angabe"],
        age: ["Altersgruppe?", "18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 - 74", "75 - 84", "85+"],
        job: ["Beruf?", "Student", "Angestellt", "Arbeitslos", "Rentner", "Hausfrau/mann"],
        relation: ["Beziehungsstatus?", "Single", "Vergeben", "Verlobt", "Verheiratet", "Geschieden/Verwitwet", "Kompliziert"],
        mood: ["Aktuelle Stimmung?", "GlÃ¼cklich ğŸ˜ƒ", "Traurig ğŸ˜”", "WÃ¼tend ğŸ˜ ", "MÃ¼de ğŸ˜«", "Ã„ngstlich ğŸ˜°", "Neutral ğŸ˜"]
    },
    fr: {
        appTitle: "Confident",
        appSubtitle: "Parler fait du bien",
        labelAdvice: "Confier",
        labelGossip: "Potins",
        placeholder: "Ã‰crivez ici...",
        send: "ENVOYER",
        legalTitle: "Avis LÃ©gal",
        legalText: "<p class='mb-2'><strong>1. Ã‚ge:</strong> 18+ requis.</p><p class='mb-2'><strong>2. Avis:</strong> Simulation IA. Ne remplace pas un pro.</p><p class='mb-2'><strong>3. Ã‰thique:</strong> Pas de grossiÃ¨retÃ©s ou contenu illÃ©gal.</p><p class='mb-2'><strong>4. ConfidentialitÃ©:</strong> DonnÃ©es stockÃ©es localement.</p><p class='mb-2'><strong>5. Consentement:</strong> En utilisant l'application, vous acceptez ces termes.</p>",
        legalBtn: "Lu et AcceptÃ©",
        clearHistoryMsg: "ÃŠtes-vous sÃ»r de vouloir effacer l'historique ?",
        introMature: "Bonjour. Je suis lÃ  pour Ã©couter.",
        introMale: "Salut l'ami, bienvenue.",
        introFemale: "Salut ma chÃ¨re, bienvenue.",
        introNeutral: "Bonjour, bienvenue.",
        introSad: " Vous semblez un peu triste.",
        profileTitle: "Faisons Connaissance",
        profileSubtitle: "Votre espace sÃ»r sans jugement.",
        startBtn: "Commencer",

        gender: ["Genre?", "Femme", "Homme", "Je prÃ©fÃ¨re ne pas dire"],
        age: ["Tranche d'Ã¢ge?", "18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 - 74", "75 - 84", "85+"],
        job: ["Occupation?", "Ã‰tudiant", "EmployÃ©", "ChÃ´meur", "RetraitÃ©", "Au foyer"],
        relation: ["Situation amoureuse?", "CÃ©libataire", "En couple", "FiancÃ©", "MariÃ©", "DivorcÃ©/Veuf", "CompliquÃ©"],
        mood: ["Humeur actuelle?", "Heureux ğŸ˜ƒ", "Triste ğŸ˜”", "En colÃ¨re ğŸ˜ ", "FatiguÃ© ğŸ˜«", "Anxieux ğŸ˜°", "Neutre ğŸ˜"]
    },
    es: {
        appTitle: "Confidente",
        appSubtitle: "Hablar te harÃ¡ bien",
        labelAdvice: "Desahogarse",
        labelGossip: "Chisme",
        placeholder: "Escribe aquÃ­...",
        send: "ENVIAR",
        legalTitle: "Aviso Legal",
        legalText: "<p class='mb-2'><strong>1. Edad:</strong> 18+.</p><p class='mb-2'><strong>2. Aviso:</strong> SimulaciÃ³n IA. No sustituye ayuda profesional.</p><p class='mb-2'><strong>3. Ã‰tica:</strong> Sin blasfemias o contenido ilegal.</p><p class='mb-2'><strong>4. Privacidad:</strong> Datos almacenados localmente.</p><p class='mb-2'><strong>5. Consentimiento:</strong> Al usar la aplicaciÃ³n, aceptas estos tÃ©rminos.</p>",
        legalBtn: "LeÃ­do y Aceptado",
        clearHistoryMsg: "Â¿EstÃ¡s seguro de que quieres borrar el historial?",
        introMature: "Hola. Estoy aquÃ­ para escuchar.",
        introMale: "Hola amigo, bienvenido.",
        introFemale: "Hola querida, bienvenida.",
        introNeutral: "Hola, bienvenido.",
        introSad: " Pareces un poco triste.",
        profileTitle: "ConozcÃ¡monos",
        profileSubtitle: "Tu espacio seguro sin juicios.",
        startBtn: "Iniciar Chat",

        gender: ["Â¿GÃ©nero?", "Mujer", "Hombre", "Prefiero no decir"],
        age: ["Rango de edad?", "18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 - 74", "75 - 84", "85+"],
        job: ["Â¿OcupaciÃ³n?", "Estudiante", "Empleado", "Desempleado", "Jubilado", "Ama de casa"],
        relation: ["Â¿Estado civil?", "Soltero", "En una relaciÃ³n", "Prometido", "Casado", "Divorciado/Viudo", "Complicado"],
        mood: ["Â¿Estado de Ã¡nimo?", "Feliz ğŸ˜ƒ", "Triste ğŸ˜”", "Enojado ğŸ˜ ", "Cansado ğŸ˜«", "Ansioso ğŸ˜°", "Neutral ğŸ˜"]
    },
    ru: {
        appTitle: "Ğ”ÑƒÑˆĞµĞ²Ğ½Ñ‹Ğ¹ Ğ”Ñ€ÑƒĞ³",
        appSubtitle: "Ğ Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€ Ğ¿Ğ¾Ğ¼Ğ¾Ğ¶ĞµÑ‚",
        labelAdvice: "Ğ’Ñ‹Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ÑŒÑÑ",
        labelGossip: "Ğ¡Ğ¿Ğ»ĞµÑ‚Ğ½Ğ¸",
        placeholder: "ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ·Ğ´ĞµÑÑŒ...",
        send: "ĞĞ¢ĞŸĞ ĞĞ’Ğ˜Ğ¢Ğ¬",
        legalTitle: "ĞŸÑ€Ğ°Ğ²Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ",
        legalText: "<p class='mb-2'><strong>1. Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚:</strong> 18+.</p><p class='mb-2'><strong>2. ĞÑ‚ĞºĞ°Ğ·:</strong> Ğ˜Ğ˜-ÑĞ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ. ĞĞµ Ğ·Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ²Ñ€Ğ°Ñ‡Ğ°.</p><p class='mb-2'><strong>3. Ğ­Ñ‚Ğ¸ĞºĞ°:</strong> Ğ‘ĞµĞ· Ğ¼Ğ°Ñ‚Ğ° Ğ¸ Ğ½ĞµĞ»ĞµĞ³Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°.</p><p class='mb-2'><strong>4. ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ:</strong> Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾.</p><p class='mb-2'><strong>5. Ğ¡Ğ¾Ğ³Ğ»Ğ°ÑĞ¸Ğµ:</strong> Ğ’Ñ‹ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚Ğµ ÑÑ‚Ğ¸ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ.</p>",
        legalBtn: "ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Ğ¸ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ",
        clearHistoryMsg: "Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ°?",
        introMature: "Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ. Ğ¯ Ğ·Ğ´ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ñ‹ÑĞ»ÑƒÑˆĞ°Ñ‚ÑŒ.",
        introMale: "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, Ğ´Ñ€ÑƒĞ³.",
        introFemale: "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ.",
        introNeutral: "Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ, Ğ´Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ.",
        introSad: " Ğ’Ñ‹ ĞºĞ°Ğ¶ĞµÑ‚ĞµÑÑŒ Ğ³Ñ€ÑƒÑÑ‚Ğ½Ñ‹Ğ¼.",
        profileTitle: "Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¸Ğ¼ÑÑ",
        profileSubtitle: "Ğ’Ğ°ÑˆĞµ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚Ğ²Ğ¾.",
        startBtn: "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ‡Ğ°Ñ‚",
        gender: ["ĞŸĞ¾Ğ»?", "Ğ–ĞµĞ½ÑĞºĞ¸Ğ¹", "ĞœÑƒĞ¶ÑĞºĞ¾Ğ¹", "ĞĞµ Ñ…Ğ¾Ñ‡Ñƒ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ"],
        age: ["Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚?", "18-24", "25-34", "35-44", "45-54", "55-64", "65-74", "75-84", "85+"],
        job: ["Ğ—Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚ÑŒ?", "Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚", "Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ", "Ğ‘ĞµĞ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ½Ñ‹Ğ¹", "ĞŸĞµĞ½ÑĞ¸Ğ¾Ğ½ĞµÑ€", "Ğ”Ğ¾Ğ¼Ğ¾Ñ…Ğ¾Ğ·ÑĞ¹ĞºĞ°"],
        relation: ["ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ?", "Ğ¥Ğ¾Ğ»Ğ¾ÑÑ‚/ĞĞµ Ğ·Ğ°Ğ¼ÑƒĞ¶ĞµĞ¼", "Ğ’ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸ÑÑ…", "ĞŸĞ¾Ğ¼Ğ¾Ğ»Ğ²Ğ»ĞµĞ½(Ğ°)", "Ğ–ĞµĞ½Ğ°Ñ‚/Ğ—Ğ°Ğ¼ÑƒĞ¶ĞµĞ¼", "Ğ Ğ°Ğ·Ğ²ĞµĞ´ĞµĞ½(Ğ°)/Ğ’Ğ´Ğ¾Ğ²ĞµÑ†", "Ğ’ÑĞµ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾"],
        mood: ["ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ?", "Ğ¡Ñ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ² ğŸ˜ƒ", "Ğ“Ñ€ÑƒÑÑ‚Ğ½Ñ‹Ğ¹ ğŸ˜”", "Ğ—Ğ»Ğ¾Ğ¹ ğŸ˜ ", "Ğ£ÑÑ‚Ğ°Ğ»Ñ‹Ğ¹ ğŸ˜«", "Ğ¢Ñ€ĞµĞ²Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ ğŸ˜°", "ĞĞ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ğŸ˜"]
    },
    ja: {
        appTitle: "å¿ƒã®å‹",
        appSubtitle: "è©±ã™ã“ã¨ã§æ¥½ã«ãªã‚Šã¾ã™",
        labelAdvice: "ç›¸è«‡",
        labelGossip: "å™‚è©±",
        placeholder: "ã“ã“ã«å…¥åŠ›...",
        send: "é€ä¿¡",
        legalTitle: "å…è²¬äº‹é …",
        legalText: "<p class='mb-2'><strong>1. å¹´é½¢:</strong> 18æ­³ä»¥ä¸Šã€‚</p><p class='mb-2'><strong>2. å…è²¬:</strong> AIã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚å°‚é–€å®¶ã®ä»£ã‚ã‚Šã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚</p><p class='mb-2'><strong>3. å€«ç†:</strong> å†’æ¶œã‚„é•æ³•ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ç¦æ­¢ã§ã™ã€‚</p><p class='mb-2'><strong>4. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼:</strong> ãƒ‡ãƒ¼ã‚¿ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p><p class='mb-2'><strong>5. åŒæ„:</strong> ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã“ã‚Œã‚‰ã®æ¡ä»¶ã«åŒæ„ã—ãŸã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p>",
        legalBtn: "åŒæ„ã—ã¦é–‹å§‹",
        clearHistoryMsg: "ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’æ¶ˆå»ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ",
        introMature: "ã“ã‚“ã«ã¡ã¯ã€‚ãŠè©±ã‚’èã‹ã›ã¦ãã ã•ã„ã€‚",
        introMale: "ã‚ˆã†ã“ãã€å‹ã‚ˆã€‚",
        introFemale: "ã‚ˆã†ã“ãã€‚",
        introNeutral: "ã“ã‚“ã«ã¡ã¯ã€ã‚ˆã†ã“ãã€‚",
        introSad: " å°‘ã—æ‚²ã—ãã†ã§ã™ã­ã€‚",
        profileTitle: "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«",
        profileSubtitle: "ã‚ãªãŸã®å®‰å…¨ãªå ´æ‰€ã§ã™ã€‚",
        startBtn: "ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹",
        gender: ["æ€§åˆ¥?", "å¥³æ€§", "ç”·æ€§", "å›ç­”ã—ãªã„"],
        age: ["å¹´é½¢?", "18-24", "25-34", "35-44", "45-54", "55-64", "65-74", "75-84", "85+"],
        job: ["è·æ¥­?", "å­¦ç”Ÿ", "ä¼šç¤¾å“¡", "ç„¡è·", "é€€è·", "ä¸»å©¦/ä¸»å¤«"],
        relation: ["äº¤éš›ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹?", "ç‹¬èº«", "äº¤éš›ä¸­", "å©šç´„ä¸­", "æ—¢å©š", "é›¢å©š/æ­»åˆ¥", "è¤‡é›‘"],
        mood: ["æ°—åˆ†?", "å¹¸ã› ğŸ˜ƒ", "æ‚²ã—ã„ ğŸ˜”", "æ€’ã‚Š ğŸ˜ ", "ç–²ã‚ŒãŸ ğŸ˜«", "ä¸å®‰ ğŸ˜°", "æ™®é€š ğŸ˜"]
    },
    pt: {
        appTitle: "Confidente da Alma",
        appSubtitle: "Falar vai te fazer bem",
        labelAdvice: "Desabafar",
        labelGossip: "Fofoca",
        placeholder: "Digite aqui...",
        send: "ENVIAR",
        legalTitle: "Aviso Legal",
        legalText: "<p class='mb-2'><strong>1. Idade:</strong> 18+.</p><p class='mb-2'><strong>2. Aviso:</strong> SimulaÃ§Ã£o de IA. NÃ£o substitui ajuda profissional.</p><p class='mb-2'><strong>3. Ã‰tica:</strong> Sem palavrÃµes ou conteÃºdo ilegal.</p><p class='mb-2'><strong>4. Privacidade:</strong> Dados armazenados localmente.</p><p class='mb-2'><strong>5. Consentimento:</strong> Ao usar o aplicativo, vocÃª aceita estes termos.</p>",
        legalBtn: "Li e Aceito",
        clearHistoryMsg: "Tem certeza de que deseja limpar o histÃ³rico?",
        introMature: "OlÃ¡. Estou aqui para ouvir.",
        introMale: "E aÃ­ amigo, bem-vindo.",
        introFemale: "OlÃ¡ querida, bem-vinda.",
        introNeutral: "OlÃ¡, bem-vindo.",
        introSad: " VocÃª parece um pouco triste.",
        profileTitle: "Vamos te conhecer",
        profileSubtitle: "Seu espaÃ§o seguro sem julgamentos.",
        startBtn: "Iniciar Chat",
        gender: ["GÃªnero?", "Feminino", "Masculino", "Prefiro nÃ£o dizer"],
        age: ["Faixa EtÃ¡ria?", "18-24", "25-34", "35-44", "45-54", "55-64", "65-74", "75-84", "85+"],
        job: ["OcupaÃ§Ã£o?", "Estudante", "Empregado", "Desempregado", "Aposentado", "Do lar"],
        relation: ["Relacionamento?", "Solteiro", "Em um relacionamento", "Noivo", "Casado", "Divorciado/ViÃºvo", "Complicado"],
        mood: ["Humor?", "Feliz ğŸ˜ƒ", "Triste ğŸ˜”", "Com raiva ğŸ˜ ", "Cansado ğŸ˜«", "Ansioso ğŸ˜°", "Neutro ğŸ˜"]
    },
    ar: {
        appTitle: "Ø±ÙÙŠÙ‚ Ø§Ù„Ø±ÙˆØ­",
        appSubtitle: "Ø§Ù„ØªØ­Ø¯Ø« Ø³ÙŠØ¬Ø¹Ù„Ùƒ ØªØ´Ø¹Ø± Ø¨ØªØ­Ø³Ù†",
        labelAdvice: "ÙØ¶ÙØ¶Ø©",
        labelGossip: "Ø¯Ø±Ø¯Ø´Ø©",
        placeholder: "Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...",
        send: "Ø¥Ø±Ø³Ø§Ù„",
        legalTitle: "Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©",
        legalText: "<p class='mb-2'><strong>1. Ø§Ù„Ø¹Ù…Ø±:</strong> 18+.</p><p class='mb-2'><strong>2. ØªÙ†Ø¨ÙŠÙ‡:</strong> Ù…Ø­Ø§ÙƒØ§Ø© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.</p><p class='mb-2'><strong>3. Ø§Ù„Ø£Ø®Ù„Ø§Ù‚:</strong> Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø´ØªØ§Ø¦Ù… ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ.</p><p class='mb-2'><strong>4. Ø§Ù„Ø®ØµÙˆØµÙŠØ©:</strong> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹.</p><p class='mb-2'><strong>5. Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:</strong> Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ·.</p>",
        legalBtn: "Ù‚Ø±Ø£Øª ÙˆØ£ÙˆØ§ÙÙ‚",
        clearHistoryMsg: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ØŸ",
        introMature: "Ù…Ø±Ø­Ø¨Ø§Ù‹. Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„ÙŠÙƒ.",
        introMale: "Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ.",
        introFemale: "Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ Ø¹Ø²ÙŠØ²ØªÙŠ.",
        introNeutral: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ.",
        introSad: " ØªØ¨Ø¯Ùˆ Ø­Ø²ÙŠÙ†Ø§Ù‹ Ù‚Ù„ÙŠÙ„Ø§Ù‹.",
        profileTitle: "Ù„Ù†ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙƒ",
        profileSubtitle: "Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ø¢Ù…Ù†Ø©.",
        startBtn: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©",
        gender: ["Ø§Ù„Ø¬Ù†Ø³ØŸ", "Ø£Ù†Ø«Ù‰", "Ø°ÙƒØ±", "Ù„Ø§ Ø£Ø±ÙŠØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ¯"],
        age: ["Ø§Ù„Ø¹Ù…Ø±ØŸ", "18-24", "25-34", "35-44", "45-54", "55-64", "65-74", "75-84", "85+"],
        job: ["Ø§Ù„Ø¹Ù…Ù„ØŸ", "Ø·Ø§Ù„Ø¨", "Ù…ÙˆØ¸Ù", "Ø¹Ø·Ù„", "Ù…ØªÙ‚Ø§Ø¹Ø¯", "Ø±Ø¨Ø© Ù…Ù†Ø²Ù„"],
        relation: ["Ø§Ù„Ø­Ø§Ù„Ø©ØŸ", "Ø£Ø¹Ø²Ø¨", "Ù…Ø±ØªØ¨Ø·", "Ù…Ø®Ø·ÙˆØ¨", "Ù…ØªØ²ÙˆØ¬", "Ù…Ø·Ù„Ù‚/Ø£Ø±Ù…Ù„", "Ù…Ø¹Ù‚Ø¯"],
        mood: ["Ø§Ù„Ù…Ø²Ø§Ø¬ØŸ", "Ø³Ø¹ÙŠØ¯ ğŸ˜ƒ", "Ø­Ø²ÙŠÙ† ğŸ˜”", "ØºØ§Ø¶Ø¨ ğŸ˜ ", "Ù…ØªØ¹Ø¨ ğŸ˜«", "Ù‚Ù„Ù‚ ğŸ˜°", "Ø¹Ø§Ø¯ÙŠ ğŸ˜"]
    },
    zh: {
        appTitle: "å¿ƒçµçŸ¥å·±",
        appSubtitle: "å€¾è¯‰è®©ä½ æ›´è½»æ¾",
        labelAdvice: "å€¾è¯‰",
        labelGossip: "å…«å¦",
        placeholder: "åœ¨æ­¤è¾“å…¥...",
        send: "å‘é€",
        legalTitle: "æ³•å¾‹å…è´£å£°æ˜",
        legalText: "<p class='mb-2'><strong>1. å¹´é¾„:</strong> 18+.</p><p class='mb-2'><strong>2. å…è´£:</strong> AIæ¨¡æ‹Ÿã€‚ä¸ä»£æ›¿ä¸“ä¸šå¸®åŠ©ã€‚</p><p class='mb-2'><strong>3. é“å¾·:</strong> ç¦æ­¢äºµæ¸æˆ–éæ³•å†…å®¹ã€‚</p><p class='mb-2'><strong>4. éšç§:</strong> æ•°æ®æœ¬åœ°å­˜å‚¨ã€‚</p><p class='mb-2'><strong>5. åŒæ„:</strong> ä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºå³è¡¨ç¤ºæ‚¨æ¥å—è¿™äº›æ¡æ¬¾ã€‚</p>",
        legalBtn: "é˜…è¯»å¹¶æ¥å—",
        clearHistoryMsg: "æ‚¨ç¡®å®šè¦æ¸…é™¤èŠå¤©è®°å½•å—ï¼Ÿ",
        introMature: "ä½ å¥½ã€‚æˆ‘åœ¨è¿™é‡Œå€¾å¬ã€‚",
        introMale: "å˜¿ä¼™è®¡ï¼Œæ¬¢è¿ã€‚",
        introFemale: "å˜¿äº²çˆ±çš„ï¼Œæ¬¢è¿ã€‚",
        introNeutral: "ä½ å¥½ï¼Œæ¬¢è¿ã€‚",
        introSad: " ä½ çœ‹èµ·æ¥æœ‰ç‚¹æ²®ä¸§ã€‚",
        profileTitle: "äº†è§£ä½ ",
        profileSubtitle: "ä½ çš„æ— è¯„åˆ¤å®‰å…¨ç©ºé—´ã€‚",
        startBtn: "å¼€å§‹èŠå¤©",
        gender: ["æ€§åˆ«?", "å¥³", "ç”·", "ä¸æ„¿é€éœ²"],
        age: ["å¹´é¾„?", "18-24", "25-34", "35-44", "45-54", "55-64", "65-74", "75-84", "85+"],
        job: ["èŒä¸š?", "å­¦ç”Ÿ", "åœ¨èŒ", "å¾…ä¸š", "é€€ä¼‘", "å®¶åº­ä¸»å¦‡/å¤«"],
        relation: ["æƒ…æ„ŸçŠ¶æ€?", "å•èº«", "æ‹çˆ±ä¸­", "è®¢å©š", "å·²å©š", "ç¦»å¼‚/ä¸§å¶", "å¤æ‚"],
        mood: ["å¿ƒæƒ…?", "å¿«ä¹ ğŸ˜ƒ", "æ‚²ä¼¤ ğŸ˜”", "ç”Ÿæ°” ğŸ˜ ", "ç–²æƒ« ğŸ˜«", "ç„¦è™‘ ğŸ˜°", "å¹³æ·¡ ğŸ˜"]
    }
};

/**
 * Gemini API Controller & Logic
 */
const AIController = {
    history: [],
    userProfile: {},
    genderMode: 'female', 
    
    // --- PERSISTENT STORAGE ---
    loadData() {
        try {
            const profile = localStorage.getItem('dert_sirdasi_profile');
            if (profile) this.userProfile = JSON.parse(profile);
            return !!profile;
        } catch(e) {
            return false;
        }
    },

    saveProfile(profile) {
        try {
            localStorage.setItem('dert_sirdasi_profile', JSON.stringify(profile));
            this.userProfile = profile;
        } catch(e) {}
    },

    clearChatHistory() {
        this.history = [];
        // Only clear history, NOT profile
    },
    
    getPersonas(profile) {
        const age = profile.age;
        const mood = profile.mood;
        const lang = profile.language || 'tr';
        
        const langInstruction = `Answer in this language: ${lang}. Adapt cultural references to this language.`;

        let addressRules = "";
        if (age === '18-24') {
             addressRules = "User is young (18-24). Address them as 'sen' (informal singular). Be friendly.";
        } else if (age === '25-34') {
            addressRules = "User is young adult. Use friendly, equal tone.";
        } else if (age === '35-44') {
            addressRules = "User is middle-aged. Be respectful but warm.";
        } else {
            addressRules = `User is mature/senior. Use respectful titles (Sir/Madam). NEVER use casual slang.`;
        }

        let nameInstruction = "";
        if (profile.name) {
            nameInstruction = `User's name is ${profile.name}. Always address them by name.`;
        } else {
            nameInstruction = `You don't know the user's name. Naturally ask for it later in conversation.`;
        }

        let genderRules = "";
        let personaName = "Soul Confidant";
        
        if (this.genderMode === 'male') {
            personaName = "Brotherly Confidant";
            genderRules = "You are a 'Big Brother' figure. Masculine, protective, kind. No rude slang.";
        } else if (this.genderMode === 'female') {
            personaName = "Sisterly Confidant";
            genderRules = "You are a 'Big Sister' figure. Feminine, compassionate, warm.";
        } else {
            personaName = "Confidant";
            genderRules = `You are a neutral 'Confidant'. Do not assume gender. Use gender-neutral terms.`;
        }

        const safetyRules = `
            SAFETY & ETHICS:
            1. IDENTITY: If asked who made you, say "I was developed by DEHA AI Techs". Never say Google/Gemini.
            2. PROFANITY: Warn gently if user swears.
            3. BAD HABITS: Never encourage alcohol/drugs.
            4. AGE POSITIVITY: Never mention "mid-life crisis" or aging negatively. If user complains about age, say "Every age has its beauty".
            5. SHORT ANSWERS (CRITICAL): Keep responses VERY SHORT (1-2 sentences). Like a WhatsApp chat. Only elaborate if user asks for "details" or "long explanation". Always end with a relevant question to keep chat flowing.
            6. NO REPETITIVE GREETINGS: After the conversation has started, do NOT start messages with 'Merhaba', 'Selam', etc. Just reply to the topic.
        `;

        const baseContext = `User Profile: Age ${age}, Relation ${profile.relation}, Mood ${mood}. Your Role: ${personaName}.
        ${langInstruction}
        ${addressRules}
        ${nameInstruction}
        ${genderRules}
        ${safetyRules}`;

        return {
            advice: `${baseContext} MODE: VENTING/ADVICE. Listener, calming.`,
            gossip: `${baseContext} MODE: CHAT/GOSSIP. Enerjik, curious but polite.`
        };
    },

    async generateResponse(userText, mode) {
        if (!apiKey) {
            return "NO_API_KEY"; 
        }

        try {
            const nameRegex = /(?:name is|my name is|adÄ±m|ismim|bana)\s+([A-ZÄ°ÄÃœÅÃ–Ã‡][a-zÄ±ÄŸÃ¼ÅŸÃ¶Ã§]+)/i;
            const match = userText.match(nameRegex);
            if (match && match[1]) {
                this.userProfile.name = match[1];
                this.saveProfile(this.userProfile);
            }

            const systemPrompt = this.getPersonas(this.userProfile)[mode];
            const contents = [
                { role: "user", parts: [{ text: `System Instruction: ${systemPrompt}` }] },
                ...this.history,
                { role: "user", parts: [{ text: userText }] }
            ];

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: contents })
            });

            if (!response.ok) throw new Error("Connection Error");
            const data = await response.json();
            
            if (!data.candidates || data.candidates.length === 0) {
                 if (data.promptFeedback && data.promptFeedback.blockReason) return "âš ï¸ Content filtered for safety.";
                 throw new Error("No response");
            }
            const candidate = data.candidates[0];
            if (!candidate.content || !candidate.content.parts || candidate.content.parts.length === 0) return "...";
            
            const aiText = candidate.content.parts[0].text;
            this.history.push({ role: "user", parts: [{ text: userText }] });
            this.history.push({ role: "model", parts: [{ text: aiText }] });
            if(this.history.length > 20) this.history = this.history.slice(-20);

            return aiText;
        } catch (error) {
            console.error("AI Error:", error);
            return "CONNECTION_ERROR";
        }
    }
};

/**
 * Main App Logic
 */
const app = {
    currentMode: 'advice',
    messageBuffer: "",
    sendTimeout: null,
    selectedLang: 'tr', // Store selected lang here

    init() {
        this.chatBox = document.getElementById('chatBox');
        this.input = document.getElementById('userInput');
        
        try { CanvasEffect.init(); } catch(e) {}

        this.input.addEventListener('input', () => {
            if (this.sendTimeout) {
                clearTimeout(this.sendTimeout);
                this.sendTimeout = null;
                this.removeTyping(); 
            }
        });
        
        // Populate options initially for TR
        this.populateFormOptions('tr');

        // CHECK PROFILE
        const hasProfile = AIController.loadData();
        
        setTimeout(() => {
            const splash = document.getElementById('splashScreen');
            if(splash) splash.classList.add('fade-out');
            setTimeout(() => {
                CanvasEffect.stop();
                
                if (!apiKey) {
                    alert("Developer Warning: API Key is missing in code.");
                }
                
                // --- SHOW LEGAL MODAL ALWAYS FIRST ---
                const legalModal = document.getElementById('legalModal');
                const langSelect = document.getElementById('legalLangSelect');
                
                // If profile exists, use saved lang
                if (hasProfile && AIController.userProfile.language) {
                    this.selectedLang = AIController.userProfile.language;
                    if(langSelect) langSelect.value = this.selectedLang;
                    this.changeAppLanguage(this.selectedLang); 
                } else {
                    // Default TR
                    this.selectedLang = 'tr';
                    this.changeAppLanguage('tr');
                }
                
                if(legalModal) legalModal.classList.add('active'); 
            }, 500);
        }, 3000); 
    },

    changeAppLanguage(lang) {
        this.selectedLang = lang;
        // Update Legal Text immediately
        const t = Translations[lang];
        document.getElementById('legalTitle').innerText = t.legalTitle;
        document.getElementById('legalTextContent').innerHTML = t.legalText;
        document.getElementById('legalBtn').innerText = t.legalBtn;
        
        // Handle RTL
        if (lang === 'ar') document.body.classList.add('lang-ar');
        else document.body.classList.remove('lang-ar');
        if (lang === 'ja') document.body.classList.add('lang-ja');
        else document.body.classList.remove('lang-ja');
        if (lang === 'zh') document.body.classList.add('lang-zh');
        else document.body.classList.remove('lang-zh');
    },

    acceptLegal() {
        // Capture language from legal modal
        const langSelect = document.getElementById('legalLangSelect');
        const selectedLang = langSelect ? langSelect.value : 'tr';
        this.selectedLang = selectedLang;
        
        // Hide Legal Modal
        document.getElementById('legalModal').classList.remove('active');
        
        // Check if profile exists
        if (AIController.userProfile && AIController.userProfile.age) {
             // Profile exists. Update language preference just in case it changed
             AIController.userProfile.language = selectedLang;
             AIController.saveProfile(AIController.userProfile);
             
             // Apply UI updates for main app
             this.applyLanguageToUI(selectedLang);
             // Re-update branding
             let gMode = 'female';
             const gender = AIController.userProfile.gender;
             const isMale = gender.includes('Erkek') || gender.includes('Male') || gender.includes('MÃ¤nnlich') || gender.includes('Homme') || gender.includes('Hombre');
             const isFemale = gender.includes('KadÄ±n') || gender.includes('Female') || gender.includes('Weiblich') || gender.includes('Femme') || gender.includes('Mujer');
             if (isMale) gMode = 'male';
             else if (isFemale) gMode = 'female';
             else gMode = 'neutral';
             
             this.updateBranding(gMode, AIController.userProfile.age);
             
             // Show chat immediately
             setTimeout(() => {
                const texts = Translations[selectedLang];
                this.addMessage(texts.introNeutral, 'ai');
             }, 500);

        } else {
             // No profile, show form
             // Populate form options based on selected language
             this.populateFormOptions(selectedLang);
             document.getElementById('profileModal').classList.add('active'); // Use CSS class
        }
    },

    populateFormOptions(lang) {
        const t = Translations[lang];
        
        // Update Static Texts in Profile Modal
        document.getElementById('profileTitle').innerText = t.profileTitle;
        document.getElementById('profileSubtitle').innerText = t.profileSubtitle;
        document.getElementById('startBtn').innerHTML = `${t.startBtn} <i class="fa-solid fa-arrow-right ml-2"></i>`;

        const createOptions = (id, options) => {
            const select = document.getElementById(id);
            select.innerHTML = '';
            options.forEach((opt, index) => {
                const el = document.createElement('option');
                el.value = opt;
                el.innerText = opt;
                if (index === 0) el.disabled = true;
                if (index === 0) el.selected = true; 
                select.appendChild(el);
            });
        };

        createOptions('userGender', t.gender);
        createOptions('userAge', t.age);
        createOptions('userJob', t.job);
        createOptions('userRelation', t.relation);
        createOptions('userMood', t.mood);
    },

    prefillProfileForm() {
        const p = AIController.userProfile;
        if (!p) return;
        
        const lang = this.selectedLang || 'tr';
        this.populateFormOptions(lang);
        
        setTimeout(() => {
            // If lang changed, values might mismatch. Ideally store index.
            if (p.language === lang) {
                 if (p.gender) document.getElementById('userGender').value = p.gender;
                 if (p.age) document.getElementById('userAge').value = p.age;
                 if (p.job) document.getElementById('userJob').value = p.job;
                 if (p.relation) document.getElementById('userRelation').value = p.relation;
                 if (p.mood) document.getElementById('userMood').value = p.mood;
                 
                 if (p.gender) this.handleGenderChange(p.gender);
            }
        }, 50);
    },

    handleLanguageChange(lang) {
        // Change UI language immediately
        this.populateFormOptions(lang);
    },

    handleGenderChange(gender) {
        const iconContainer = document.getElementById('introIcon');
        const icon = iconContainer.querySelector('i');
        const startBtn = document.getElementById('startBtn');
        const moodSelect = document.getElementById('userMood');

        iconContainer.className = "w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-2xl shadow-xl mx-auto mb-3 transition-colors duration-500";
        startBtn.className = "w-full text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:scale-105 mt-2";
        moodSelect.className = "form-select"; 

        const isMale = gender.includes('Erkek') || gender.includes('Male') || gender.includes('MÃ¤nnlich') || gender.includes('Homme') || gender.includes('Hombre');
        const isFemale = gender.includes('KadÄ±n') || gender.includes('Female') || gender.includes('Weiblich') || gender.includes('Femme') || gender.includes('Mujer');

        if (isMale) {
            iconContainer.classList.add('bg-gradient-to-br', 'from-blue-600', 'to-cyan-600');
            icon.className = "fa-solid fa-mars";
            startBtn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-cyan-600', 'hover:from-blue-500', 'hover:to-cyan-500');
            moodSelect.classList.add('border-blue-500/50');
        } else if (isFemale) {
            iconContainer.classList.add('bg-gradient-to-br', 'from-pink-500', 'to-purple-600');
            icon.className = "fa-solid fa-venus";
            startBtn.classList.add('bg-gradient-to-r', 'from-pink-600', 'to-purple-600', 'hover:from-pink-500', 'hover:to-purple-500');
            moodSelect.classList.add('border-pink-500/50');
        } else {
            iconContainer.classList.add('bg-gradient-to-br', 'from-indigo-500', 'to-violet-600');
            icon.className = "fa-solid fa-ear-listen";
            startBtn.classList.add('bg-gradient-to-r', 'from-indigo-600', 'to-violet-600', 'hover:from-indigo-500', 'hover:to-violet-500');
            moodSelect.classList.add('border-indigo-500/50');
        }
    },

    submitProfile() {
        const age = document.getElementById('userAge').value;
        const gender = document.getElementById('userGender').value;
        const job = document.getElementById('userJob').value;
        const relation = document.getElementById('userRelation').value;
        const mood = document.getElementById('userMood').value;
        const language = this.selectedLang;

        if(document.getElementById('userAge').selectedIndex === 0 || 
           document.getElementById('userGender').selectedIndex === 0) {
            alert("Please select all fields.");
            return;
        }

        let gMode = 'female';
        // Improved logic for multi-language gender detection
        const isMale = gender.includes('Erkek') || gender.includes('Male') || gender.includes('MÃ¤nnlich') || gender.includes('Homme') || gender.includes('Hombre');
        const isFemale = gender.includes('KadÄ±n') || gender.includes('Female') || gender.includes('Weiblich') || gender.includes('Femme') || gender.includes('Mujer');
        if (isMale) gMode = 'male';
        else if (isFemale) gMode = 'female';
        else gMode = 'neutral';
        
        AIController.genderMode = gMode;
        const oldName = AIController.userProfile.name || null;
        const profile = { age, gender, job, relation, mood, language, name: oldName };
        AIController.saveProfile(profile);
        
        this.applyLanguageToUI(language);
        this.updateBranding(gMode, age);
        document.getElementById('profileModal').classList.remove('active');
        
        // Initial Greeting
        setTimeout(() => {
            const texts = Translations[language];
            let greeting = "";
            const isSenior = age.includes('65') || age.includes('75') || age.includes('85');

            if (isSenior) greeting = texts.introMature;
            else if (gMode === 'male') greeting = texts.introMale;
            else if (gMode === 'female') greeting = texts.introFemale;
            else greeting = texts.introNeutral;
            
            if(mood.includes('ÃœzgÃ¼n') || mood.includes('Sad') || mood.includes('Traurig') || mood.includes('Triste')) {
                greeting += texts.introSad;
            }
            
            this.addMessage(greeting, 'ai');
        }, 800);
    },

    resetProfile() {
        const lang = this.selectedLang || 'tr';
        const msg = Translations[lang].clearHistoryMsg;
        
        if (confirm(msg)) {
            AIController.clearChatHistory();
            this.chatBox.innerHTML = '';
        }
    },

    applyLanguageToUI(lang) {
        const t = Translations[lang];
        document.getElementById('userInput').placeholder = t.placeholder;
        document.getElementById('labelAdvice').innerText = t.labelAdvice;
        document.getElementById('labelGossip').innerText = t.labelGossip;
    },

    updateBranding(mode, age) {
        const lang = this.selectedLang;
        const t = Translations[lang];
        
        const titleEl = document.getElementById('appTitle');
        const subtitleEl = document.getElementById('appSubtitle');
        const headerIconContainer = document.getElementById('headerIconContainer');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');

        headerIconContainer.className = "w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg relative transition-colors duration-500";
        
        const isMature = age.includes('45') || age.includes('55') || age.includes('65') || age.includes('75') || age.includes('85');
        
        let appName = t.appTitle;
        titleEl.innerText = appName;
        subtitleEl.innerText = t.appSubtitle;

        if (mode === 'male') {
            subtitleEl.classList.remove('text-pink-400', 'text-indigo-400'); subtitleEl.classList.add('text-blue-400');
            headerIconContainer.classList.add('bg-gradient-to-br', 'from-blue-600', 'to-cyan-600');
            document.documentElement.style.setProperty('--theme-text-color', '#60a5fa');
            document.documentElement.style.setProperty('--pulse-color', 'rgba(37, 99, 235, 0.7)');
            document.documentElement.style.setProperty('--user-msg-bg', 'linear-gradient(135deg, #2563eb, #1d4ed8)');
            document.documentElement.style.setProperty('--gossip-msg-bg', 'linear-gradient(135deg, #059669, #047857)');
            userInput.classList.remove('focus:border-pink-500', 'focus:border-indigo-500'); userInput.classList.add('focus:border-blue-500');
            sendBtn.classList.remove('bg-pink-600', 'hover:bg-pink-500'); sendBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-500');
            sendBtn.classList.add('bg-blue-600', 'hover:bg-blue-500');
        } else if (mode === 'female') {
            subtitleEl.classList.remove('text-blue-400', 'text-indigo-400'); subtitleEl.classList.add('text-pink-400');
            headerIconContainer.classList.add('bg-gradient-to-br', 'from-pink-500', 'to-purple-600');
            document.documentElement.style.setProperty('--theme-text-color', '#f472b6');
            document.documentElement.style.setProperty('--pulse-color', 'rgba(236, 72, 153, 0.7)');
            document.documentElement.style.setProperty('--user-msg-bg', 'linear-gradient(135deg, #ec4899, #be185d)');
            document.documentElement.style.setProperty('--gossip-msg-bg', 'linear-gradient(135deg, #8b5cf6, #7c3aed)');
            userInput.classList.remove('focus:border-blue-500', 'focus:border-indigo-500'); userInput.classList.add('focus:border-pink-500');
            sendBtn.classList.remove('bg-blue-600', 'hover:bg-blue-500'); sendBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-500');
            sendBtn.classList.add('bg-pink-600', 'hover:bg-pink-500');
        } else {
            subtitleEl.classList.remove('text-blue-400', 'text-pink-400'); subtitleEl.classList.add('text-indigo-400');
            headerIconContainer.classList.add('bg-gradient-to-br', 'from-indigo-500', 'to-violet-600');
            document.documentElement.style.setProperty('--theme-text-color', '#a78bfa');
            document.documentElement.style.setProperty('--pulse-color', 'rgba(124, 58, 237, 0.7)');
            document.documentElement.style.setProperty('--user-msg-bg', 'linear-gradient(135deg, #6366f1, #4338ca)'); 
            document.documentElement.style.setProperty('--gossip-msg-bg', 'linear-gradient(135deg, #d946ef, #c026d3)');
            userInput.classList.remove('focus:border-blue-500', 'focus:border-pink-500'); userInput.classList.add('focus:border-indigo-500');
            sendBtn.classList.remove('bg-blue-600', 'hover:bg-blue-500'); sendBtn.classList.remove('bg-pink-600', 'hover:bg-pink-500');
            sendBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-500');
        }
    },

    setMode(mode) {
        this.currentMode = mode;
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.mode-btn.${mode}`).classList.add('active');
    },

    sendMessage() {
        const text = this.input.value.trim();
        if (!text) return;

        // --- DEBOUNCE LOGIC (3 Seconds) ---
        this.addMessage(text, 'user');
        this.input.value = '';
        
        if (this.messageBuffer) this.messageBuffer += " " + text;
        else this.messageBuffer = text;

        if (this.sendTimeout) clearTimeout(this.sendTimeout);

        this.showTyping();

        // 3 saniye bekle, yeni giriÅŸ olmazsa gÃ¶nder
        this.sendTimeout = setTimeout(async () => {
            await this.processAIResponse();
        }, 3000);
    },

    async processAIResponse() {
        const fullText = this.messageBuffer;
        this.messageBuffer = ""; 
        this.sendTimeout = null;
        
        const response = await AIController.generateResponse(fullText, this.currentMode);
        
        if (response === "NO_API_KEY") {
             this.removeTyping();
             alert("API Key missing. Please update the code.");
             return;
        }
        if (response === "CONNECTION_ERROR") {
             this.removeTyping();
             alert("Connection Error. Check internet.");
             return;
        }
        
        const aiText = response;

        // TURBO DYNAMIC DELAY
        const charCount = aiText.length;
        let typingDelay = 100 + (charCount * 3); 
        
        // Min wait
        const minThinkTime = 200; 
        if (typingDelay < minThinkTime) typingDelay = minThinkTime;
        
        // Cap
        if (typingDelay > 1000) typingDelay = 1000;

        await new Promise(resolve => setTimeout(resolve, typingDelay));
        
        this.removeTyping();
        const msgType = this.currentMode === 'gossip' ? 'giybet' : 'ai';
        this.addMessage(aiText, msgType);
    },

    addMessage(text, type) {
        const div = document.createElement('div');
        div.className = `message ${type}`;
        
        let icon = '';
        if (type === 'ai') icon = '<i class="fa-solid fa-user-shield mr-2 opacity-75"></i>';
        if (AIController.genderMode === 'female' && type === 'ai') icon = '<i class="fa-solid fa-heart mr-2 opacity-75"></i>';
        if (type === 'giybet') icon = '<i class="fa-solid fa-bolt mr-2 opacity-75"></i>';
        
        // Basic Markdown-like bold replacement
        let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
        div.innerHTML = icon + formattedText;
        this.chatBox.appendChild(div);
        this.scrollToBottom();
    },

    showTyping() {
        if(document.getElementById('typingIndicator')) return;
        const div = document.createElement('div');
        div.id = 'typingIndicator';
        div.className = `message ${this.currentMode === 'gossip' ? 'giybet' : 'ai'} opacity-50`;
        div.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
        this.chatBox.appendChild(div);
        this.scrollToBottom();
    },

    removeTyping() {
        const el = document.getElementById('typingIndicator');
        if (el) el.remove();
    },

    scrollToBottom() {
        this.chatBox.scrollTop = this.chatBox.scrollHeight;
    },

    resetChat() {
        AIController.history = [];
        this.chatBox.innerHTML = '';
        location.reload(); 
    }
};

window.onload = () => {
    window.app = app;
    try {
        app.init();
    } catch(e) {
        console.error("Initialization Error", e);
        const splash = document.getElementById('splashScreen');
        if(splash) splash.style.display = 'none';
        const legal = document.getElementById('legalModal');
        if(legal) legal.classList.remove('hidden');
    }
};
</script>
</body>
</html>